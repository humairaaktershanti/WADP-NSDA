{% extends "master.html" %}
{% block title %}Teacher Dashboard{% endblock title %}

{% block extra_css %}
<style>
    .main-content { position: static !important; z-index: auto !important; }
    .modal { z-index: 1060 !important; }
    .modal-backdrop { z-index: 1055 !important; }
    
    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .card {
        border-radius: 12px;
        border: 1px solid #f0f0f0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .card-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--dark-gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .card-icon.primary {
        background: linear-gradient(135deg, rgba(74, 107, 223, 0.1), rgba(108, 99, 255, 0.1));
        color: var(--primary-color);
    }
    
    .card-icon.success {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(25, 135, 84, 0.1));
        color: #28a745;
    }
    
    .card-icon.warning {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
        color: #ffc107;
    }
    
    .card-icon.danger {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(214, 51, 132, 0.1));
        color: #dc3545;
    }
    
    .card-value {
        font-size: 2.4rem;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    .card-change {
        font-size: 0.9rem;
        color: var(--dark-gray);
        display: flex;
        align-items: center;
    }
    
    .card-change i {
        margin-right: 5px;
    }
    
    .card-change.positive {
        color: #28a745;
    }
    
    .card-change.negative {
        color: #dc3545;
    }
    
    .list-group-item {
        border: none;
        border-bottom: 1px solid #f1f1f1;
        padding: 0.6rem 0.8rem;
    }
    
    .list-group-item:last-child {
        border-bottom: none;
    }
    
    .calendar-container {
        position: relative;
        width: 100%;
    }
    
    .calendar-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .calendar-table th,
    .calendar-table td {
        padding: 8px;
        text-align: center;
        border: 1px solid #eee;
    }
    
    .calendar-table th {
        background-color: var(--primary-color);
        color: white;
    }
    
    .calendar-table .weekend {
        background-color: #fff3cd;
    }
    
    .calendar-table .holiday {
        background-color: #f8d7da;
    }
    
    .calendar-table .today {
        background-color: #d1ecf1;
        font-weight: bold;
    }
    
    .chart-container {
        position: relative;
        width: 100%;
        height: 300px;
    }
</style>
{% endblock extra_css %}

{% block content %}
<div class="page-header">
    <h1>Teacher Dashboard</h1>
    <p>Welcome back! Here's your teaching overview for today.</p>
</div>

<!-- Summary Cards -->
<div class="dashboard-cards">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Active Courses</div>
            <div class="card-icon primary">
                <i class="fas fa-book-open"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.courses.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.courses.active }} Active
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Total Students</div>
            <div class="card-icon success">
                <i class="fas fa-user-graduate"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.students.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.students.active }} Enrolled
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Pending Tasks</div>
            <div class="card-icon warning">
                <i class="fas fa-tasks"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.tasks.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.tasks.active }} Pending
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Classes This Week</div>
            <div class="card-icon danger">
                <i class="fas fa-calendar-week"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.classes.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.classes.active }} Scheduled
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Quick Actions</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#createCourseModal">
                    <i class="fas fa-plus me-2"></i> Create Course
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#createAssignmentModal">
                    <i class="fas fa-tasks me-2"></i> Create Assignment
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-info w-100" data-bs-toggle="modal" data-bs-target="#createLessonPlanModal">
                    <i class="fas fa-book me-2"></i> Create Lesson Plan
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#createClassRoutineModal">
                    <i class="fas fa-calendar-alt me-2"></i> Create Class Routine
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <!-- Today's Schedule -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-calendar-day me-2"></i> Today's Schedule</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="todaysScheduleChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Summary -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i> Attendance Summary</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="attendanceSummaryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activities and Pending Tasks Row -->
<div class="row mb-4">
    <!-- Recent Activities -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-history me-2"></i> Recent Activities</h5>
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#allActivitiesModal">View All</button>
            </div>
            <div class="card-body p-2">
                <ul class="list-group list-group-flush">
                    {% for activity in recent_activities %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ activity.title }}</strong>
                            <div class="text-muted small">{{ activity.course.title }}</div>
                        </div>
                        <span class="badge bg-secondary">{{ activity.created_at|timesince }} ago</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">No recent activities</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Pending Tasks -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i> Pending Tasks</h5>
                <button class="btn btn-sm btn-dark" data-bs-toggle="modal" data-bs-target="#allTasksModal">View All</button>
            </div>
            <div class="card-body p-2">
                <ul class="list-group list-group-flush">
                    {% for task in pending_tasks %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ task.title }}</strong>
                            <div class="text-muted small">{{ task.course.title }}</div>
                        </div>
                        <span class="badge bg-primary">{{ task.due_date|date:"M d" }}</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">No pending tasks</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Calendar Row -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">Calendar</h3>
                <div class="d-flex">
                    <button class="btn btn-sm btn-outline-primary me-2" id="prevMonth">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h4 class="mb-0" id="currentMonth">{{ calendar_data.month_name }} {{ calendar_data.year }}</h4>
                    <button class="btn btn-sm btn-outline-primary ms-2" id="nextMonth">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="calendar-container">
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                <th>Sat</th>
                                <th>Sun</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody">
                            {% for week in calendar_data.calendar %}
                            <tr>
                                {% for day in week %}
                                <td class="{% if day == 0 %}empty{% else %}{% if day in calendar_data.weekends %}weekend{% endif %}{% if day == now.day %}today{% endif %}{% endif %}">
                                    {% if day != 0 %}{{ day }}{% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <div class="d-flex align-items-center me-3">
                        <div class="bg-warning p-1 me-2" style="width: 20px; height: 20px;"></div>
                        <span>Weekend (Friday)</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="bg-danger p-1 me-2" style="width: 20px; height: 20px;"></div>
                        <span>Government Holiday</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Data Section -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Export Data</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <a href="{% url 'employee:export_course_data' %}" class="btn btn-outline-primary w-100">
                    <i class="fas fa-download me-2"></i> Course Data
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#assignmentListModal">
                    <i class="fas fa-tasks me-2"></i> Assignment Data
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-outline-warning w-100" data-bs-toggle="modal" data-bs-target="#lessonPlanListModal">
                    <i class="fas fa-book me-2"></i> Lesson Plan Data
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-outline-info w-100" data-bs-toggle="modal" data-bs-target="#attendanceListModal">
                    <i class="fas fa-user-check me-2"></i> Attendance Data
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Create Course Modal -->
<div class="modal fade" id="createCourseModal" tabindex="-1" aria-labelledby="createCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createCourseModalLabel">Create New Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createCourseForm" method="post" action="{% url 'employee:course_create' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="courseTitle" class="form-label">Course Title</label>
                            <input type="text" class="form-control" id="courseTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseType" class="form-label">Course Type</label>
                            <select class="form-select" id="courseType" name="course_type" required>
                                <option value="">Select a type</option>
                                <option value="online">Online</option>
                                <option value="regular">Regular</option>
                                <option value="diploma">Diploma</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="coursePrice" class="form-label">Price</label>
                            <input type="number" class="form-control" id="coursePrice" name="price" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseDuration" class="form-label">Duration</label>
                            <input type="text" class="form-control" id="courseDuration" name="duration" placeholder="e.g., 8 weeks, 3 months" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseStatus" class="form-label">Status</label>
                            <select class="form-select" id="courseStatus" name="status" required>
                                <option value="draft">Draft</option>
                                <option value="pending_approval">Pending Approval</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseSyllabus" class="form-label">Syllabus</label>
                            <input type="file" class="form-control" id="courseSyllabus" name="syllabus">
                        </div>
                        <div class="col-12 mb-3">
                            <label for="courseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="courseDescription" name="description" rows="4" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Course</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Assignment Modal -->
<div class="modal fade" id="createAssignmentModal" tabindex="-1" aria-labelledby="createAssignmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createAssignmentModalLabel">Create New Assignment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createAssignmentForm" method="post" action="{% url 'employee:assignment_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="assignmentCourse" class="form-label">Course</label>
                            <select class="form-select" id="assignmentCourse" name="course" required>
                                <option value="">Select a course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="assignmentTitle" class="form-label">Assignment Title</label>
                            <input type="text" class="form-control" id="assignmentTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="assignmentDueDate" class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="assignmentDueDate" name="due_date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="assignmentTotalMarks" class="form-label">Total Marks</label>
                            <input type="number" class="form-control" id="assignmentTotalMarks" name="total_marks" min="0" step="0.01" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="assignmentDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="assignmentDescription" name="description" rows="4" required></textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="assignmentActive" name="is_active" checked>
                                <label class="form-check-label" for="assignmentActive">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Assignment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Lesson Plan Modal -->
<div class="modal fade" id="createLessonPlanModal" tabindex="-1" aria-labelledby="createLessonPlanModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createLessonPlanModalLabel">Create New Lesson Plan</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createLessonPlanForm" method="post" action="{% url 'employee:lessonplan_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="lessonPlanCourse" class="form-label">Course</label>
                            <select class="form-select" id="lessonPlanCourse" name="course" required>
                                <option value="">Select a course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lessonPlanTitle" class="form-label">Lesson Title</label>
                            <input type="text" class="form-control" id="lessonPlanTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lessonPlanDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="lessonPlanDate" name="date" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="lessonPlanContent" class="form-label">Content</label>
                            <textarea class="form-control" id="lessonPlanContent" name="content" rows="6" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-info">Create Lesson Plan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Class Routine Modal -->
<div class="modal fade" id="createClassRoutineModal" tabindex="-1" aria-labelledby="createClassRoutineModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createClassRoutineModalLabel">Create New Class Routine</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createClassRoutineForm" method="post" action="{% url 'employee:classroutine_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="routineCourse" class="form-label">Course</label>
                            <select class="form-select" id="routineCourse" name="course" required>
                                <option value="">Select a course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="routineDay" class="form-label">Day of Week</label>
                            <select class="form-select" id="routineDay" name="day_of_week" required>
                                <option value="">Select a day</option>
                                <option value="monday">Monday</option>
                                <option value="tuesday">Tuesday</option>
                                <option value="wednesday">Wednesday</option>
                                <option value="thursday">Thursday</option>
                                <option value="friday">Friday</option>
                                <option value="saturday">Saturday</option>
                                <option value="sunday">Sunday</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="routineStartTime" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="routineStartTime" name="start_time" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="routineEndTime" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="routineEndTime" name="end_time" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="routineRoom" class="form-label">Room</label>
                            <input type="text" class="form-control" id="routineRoom" name="room" placeholder="e.g., Room 101">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="routineActive" name="is_active" checked>
                                <label class="form-check-label" for="routineActive">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Create Class Routine</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Assignment List Modal -->
<div class="modal fade" id="assignmentListModal" tabindex="-1" aria-labelledby="assignmentListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="assignmentListModalLabel">Manage Assignments</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Assignments</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createAssignmentModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Create New
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="assignmentCourseFilter">
                                    <option value="">All Courses</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="assignmentStatusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="1">Active</option>
                                    <option value="0">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Course</th>
                                <th>Due Date</th>
                                <th>Total Marks</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentTableBody">
                            {% for assignment in assignments %}
                            <tr>
                                <td>{{ assignment.title }}</td>
                                <td>{{ assignment.course.title }}</td>
                                <td>{{ assignment.due_date|date:"Y-m-d" }}</td>
                                <td>{{ assignment.total_marks }}</td>
                                <td>
                                    {% if assignment.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateAssignmentModal{{ assignment.id }}">
                                        Update
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="confirmAssignmentDelete({{ assignment.id }})">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assignment Update Modals -->
{% for assignment in assignments %}
<div class="modal fade" id="updateAssignmentModal{{ assignment.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:assignment_update' assignment.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Assignment: {{ assignment.title }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Course</label>
                            <select class="form-select" name="course" required>
                                {% for course in courses %}
                                <option value="{{ course.id }}" {% if course.id == assignment.course.id %}selected{% endif %}>{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Assignment Title</label>
                            <input type="text" class="form-control" name="title" value="{{ assignment.title }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Due Date</label>
                            <input type="date" class="form-control" name="due_date" value="{{ assignment.due_date|date:'Y-m-d' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Total Marks</label>
                            <input type="number" class="form-control" name="total_marks" value="{{ assignment.total_marks }}" min="0" step="0.01" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="4" required>{{ assignment.description }}</textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_active" id="assignmentActive{{ assignment.id }}" {% if assignment.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="assignmentActive{{ assignment.id }}">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Assignment</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Lesson Plan List Modal -->
<div class="modal fade" id="lessonPlanListModal" tabindex="-1" aria-labelledby="lessonPlanListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="lessonPlanListModalLabel">Manage Lesson Plans</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Lesson Plans</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createLessonPlanModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Create New
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="lessonPlanCourseFilter">
                                    <option value="">All Courses</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <input type="month" class="form-control" id="lessonPlanMonthFilter" placeholder="Filter by month">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Course</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="lessonPlanTableBody">
                            {% for lesson_plan in lesson_plans %}
                            <tr>
                                <td>{{ lesson_plan.title }}</td>
                                <td>{{ lesson_plan.course.title }}</td>
                                <td>{{ lesson_plan.date|date:"Y-m-d" }}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateLessonPlanModal{{ lesson_plan.id }}">
                                        Update
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="confirmLessonPlanDelete({{ lesson_plan.id }})">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lesson Plan Update Modals -->
{% for lesson_plan in lesson_plans %}
<div class="modal fade" id="updateLessonPlanModal{{ lesson_plan.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:lessonplan_update' lesson_plan.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Lesson Plan: {{ lesson_plan.title }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Course</label>
                            <select class="form-select" name="course" required>
                                {% for course in courses %}
                                <option value="{{ course.id }}" {% if course.id == lesson_plan.course.id %}selected{% endif %}>{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Lesson Title</label>
                            <input type="text" class="form-control" name="title" value="{{ lesson_plan.title }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" value="{{ lesson_plan.date|date:'Y-m-d' }}" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Content</label>
                            <textarea class="form-control" name="content" rows="6" required>{{ lesson_plan.content }}</textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Lesson Plan</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Class Routine List Modal -->
<div class="modal fade" id="classRoutineListModal" tabindex="-1" aria-labelledby="classRoutineListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="classRoutineListModalLabel">Manage Class Routines</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Class Routines</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createClassRoutineModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Create New
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="classRoutineCourseFilter">
                                    <option value="">All Courses</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="classRoutineDayFilter">
                                    <option value="">All Days</option>
                                    <option value="monday">Monday</option>
                                    <option value="tuesday">Tuesday</option>
                                    <option value="wednesday">Wednesday</option>
                                    <option value="thursday">Thursday</option>
                                    <option value="friday">Friday</option>
                                    <option value="saturday">Saturday</option>
                                    <option value="sunday">Sunday</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Day</th>
                                <th>Time</th>
                                <th>Room</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="classRoutineTableBody">
                            {% for routine in class_routines %}
                            <tr>
                                <td>{{ routine.course.title }}</td>
                                <td>{{ routine.day_of_week|title }}</td>
                                <td>{{ routine.start_time }} - {{ routine.end_time }}</td>
                                <td>{{ routine.room }}</td>
                                <td>
                                    {% if routine.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateClassRoutineModal{{ routine.id }}">
                                        Update
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="confirmClassRoutineDelete({{ routine.id }})">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Class Routine Update Modals -->
{% for routine in class_routines %}
<div class="modal fade" id="updateClassRoutineModal{{ routine.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:classroutine_update' routine.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Class Routine</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Course</label>
                            <select class="form-select" name="course" required>
                                {% for course in courses %}
                                <option value="{{ course.id }}" {% if course.id == routine.course.id %}selected{% endif %}>{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Day of Week</label>
                            <select class="form-select" name="day_of_week" required>
                                <option value="monday" {% if routine.day_of_week == 'monday' %}selected{% endif %}>Monday</option>
                                <option value="tuesday" {% if routine.day_of_week == 'tuesday' %}selected{% endif %}>Tuesday</option>
                                <option value="wednesday" {% if routine.day_of_week == 'wednesday' %}selected{% endif %}>Wednesday</option>
                                <option value="thursday" {% if routine.day_of_week == 'thursday' %}selected{% endif %}>Thursday</option>
                                <option value="friday" {% if routine.day_of_week == 'friday' %}selected{% endif %}>Friday</option>
                                <option value="saturday" {% if routine.day_of_week == 'saturday' %}selected{% endif %}>Saturday</option>
                                <option value="sunday" {% if routine.day_of_week == 'sunday' %}selected{% endif %}>Sunday</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-control" name="start_time" value="{{ routine.start_time|time:'H:i' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">End Time</label>
                            <input type="time" class="form-control" name="end_time" value="{{ routine.end_time|time:'H:i' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Room</label>
                            <input type="text" class="form-control" name="room" value="{{ routine.room }}" placeholder="e.g., Room 101">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_active" id="routineActive{{ routine.id }}" {% if routine.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="routineActive{{ routine.id }}">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Class Routine</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Attendance List Modal -->
<div class="modal fade" id="attendanceListModal" tabindex="-1" aria-labelledby="attendanceListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="attendanceListModalLabel">Manage Attendance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Attendance</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createAttendanceModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Mark Attendance
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <select class="form-select" id="attendanceCourseFilter">
                                    <option value="">All Courses</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <input type="date" class="form-control" id="attendanceDateFilter" placeholder="Filter by date">
                            </div>
                            <div class="col-md-4 mb-3">
                                <select class="form-select" id="attendanceStatusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="present">Present</option>
                                    <option value="absent">Absent</option>
                                    <option value="leave">On Leave</option>
                                    <option value="late">Late</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Course</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Check In</th>
                                <th>Check Out</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            {% for record in attendance_records %}
                            <tr>
                                <td>{{ record.user.first_name }} {{ record.user.last_name }}</td>
                                <td>{{ record.user.enrollments.first.course.title|default:"-" }}</td>
                                <td>{{ record.date|date:"Y-m-d" }}</td>
                                <td>
                                    <span class="badge 
                                        {% if record.status == 'present' %}bg-success
                                        {% elif record.status == 'absent' %}bg-danger
                                        {% elif record.status == 'leave' %}bg-warning
                                        {% elif record.status == 'late' %}bg-info
                                        {% endif %}">
                                        {{ record.status|title }}
                                    </span>
                                </td>
                                <td>{{ record.check_in_time|time:"H:i"|default:"-" }}</td>
                                <td>{{ record.check_out_time|time:"H:i"|default:"-" }}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateAttendanceModal{{ record.id }}">
                                        Update
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Attendance Modal -->
<div class="modal fade" id="createAttendanceModal" tabindex="-1" aria-labelledby="createAttendanceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createAttendanceModalLabel">Mark Attendance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createAttendanceForm" method="post" action="{% url 'employee:attendance_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="attendanceStudent" class="form-label">Student</label>
                            <select class="form-select" id="attendanceStudent" name="user" required>
                                <option value="">Select a student</option>
                                {% for student in students %}
                                <option value="{{ student.id }}">{{ student.first_name }} {{ student.last_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="attendanceDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="attendanceDate" name="date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="attendanceStatus" class="form-label">Status</label>
                            <select class="form-select" id="attendanceStatus" name="status" required>
                                <option value="present">Present</option>
                                <option value="absent">Absent</option>
                                <option value="leave">On Leave</option>
                                <option value="late">Late</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="attendanceCheckIn" class="form-label">Check In Time</label>
                            <input type="time" class="form-control" id="attendanceCheckIn" name="check_in_time">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="attendanceCheckOut" class="form-label">Check Out Time</label>
                            <input type="time" class="form-control" id="attendanceCheckOut" name="check_out_time">
                        </div>
                        <div class="col-12 mb-3">
                            <label for="attendanceNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="attendanceNotes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Mark Attendance</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Attendance Update Modals -->
{% for record in attendance_records %}
<div class="modal fade" id="updateAttendanceModal{{ record.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:attendance_update' record.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Attendance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Student</label>
                            <select class="form-select" name="user" required>
                                {% for student in students %}
                                <option value="{{ student.id }}" {% if student.id == record.user.id %}selected{% endif %}>{{ student.first_name }} {{ student.last_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" value="{{ record.date|date:'Y-m-d' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status" required>
                                <option value="present" {% if record.status == 'present' %}selected{% endif %}>Present</option>
                                <option value="absent" {% if record.status == 'absent' %}selected{% endif %}>Absent</option>
                                <option value="leave" {% if record.status == 'leave' %}selected{% endif %}>On Leave</option>
                                <option value="late" {% if record.status == 'late' %}selected{% endif %}>Late</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Check In Time</label>
                            <input type="time" class="form-control" name="check_in_time" value="{{ record.check_in_time|time:'H:i' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Check Out Time</label>
                            <input type="time" class="form-control" name="check_out_time" value="{{ record.check_out_time|time:'H:i' }}">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="3">{{ record.notes }}</textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Attendance</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- All Activities Modal -->
<div class="modal fade" id="allActivitiesModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">All Recent Activities</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Assignment</th>
                                <th>Course</th>
                                <th>Created Date</th>
                                <th>Time Ago</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in recent_activities %}
                            <tr>
                                <td>{{ activity.title }}</td>
                                <td>{{ activity.course.title }}</td>
                                <td>{{ activity.created_at|date:"Y-m-d" }}</td>
                                <td>{{ activity.created_at|timesince }} ago</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No activities found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- All Tasks Modal -->
<div class="modal fade" id="allTasksModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">All Pending Tasks</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Course</th>
                                <th>Due Date</th>
                                <th>Days Remaining</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in pending_tasks %}
                            <tr>
                                <td>{{ task.title }}</td>
                                <td>{{ task.course.title }}</td>
                                <td>{{ task.due_date|date:"Y-m-d" }}</td>
                                <td>{{ task.due_date|timesince }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No pending tasks</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Today's Schedule Chart
        const todaysScheduleCtx = document.getElementById('todaysScheduleChart').getContext('2d');
        
        fetch(`{% url 'employee:teacher_chart_data' %}?type=todays_schedule`)
            .then(response => response.json())
            .then(data => {
                new Chart(todaysScheduleCtx, {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1  // Since we're just showing presence/absence
                            }
                        }
                    }
                });
            });
        
        // Attendance Summary Chart
        const attendanceSummaryCtx = document.getElementById('attendanceSummaryChart').getContext('2d');
        
        fetch(`{% url 'employee:teacher_chart_data' %}?type=attendance_summary`)
            .then(response => response.json())
            .then(data => {
                new Chart(attendanceSummaryCtx, {
                    type: 'pie',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            });
        
        // Calendar navigation
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const currentMonthElement = document.getElementById('currentMonth');
        const calendarBody = document.getElementById('calendarBody');
        
        let currentMonth = {{ calendar_data.month_name|default:'new Date().getMonth()' }};
        let currentYear = {{ calendar_data.year|default:'new Date().getFullYear()' }};
        
        // This is a simplified version - in a real app, you would fetch calendar data for each month
        prevMonthBtn.addEventListener('click', function() {
            // Implementation would go here
            alert('Previous month functionality would be implemented here');
        });
        
        nextMonthBtn.addEventListener('click', function() {
            // Implementation would go here
            alert('Next month functionality would be implemented here');
        });
        
        // Assignment delete confirmation
        window.confirmAssignmentDelete = function(assignmentId) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                window.location.href = `{% url 'employee:assignment_delete' 0 %}`.replace('0', assignmentId);
            }
        };
        
        // Lesson Plan delete confirmation
        window.confirmLessonPlanDelete = function(lessonPlanId) {
            if (confirm('Are you sure you want to delete this lesson plan?')) {
                window.location.href = `{% url 'employee:lessonplan_delete' 0 %}`.replace('0', lessonPlanId);
            }
        };
        
        // Class Routine delete confirmation
        window.confirmClassRoutineDelete = function(classRoutineId) {
            if (confirm('Are you sure you want to delete this class routine?')) {
                window.location.href = `{% url 'employee:classroutine_delete' 0 %}`.replace('0', classRoutineId);
            }
        };
    });
</script>
{% endblock extra_js %}