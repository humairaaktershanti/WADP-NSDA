{% extends "master.html" %}
{% block title %}Faculty Dashboard{% endblock title %}

{% block extra_css %}
<style>
    .main-content { position: static !important; z-index: auto !important; }
    .modal { z-index: 1060 !important; }
    .modal-backdrop { z-index: 1055 !important; }
    
    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .card {
        border-radius: 12px;
        border: 1px solid #f0f0f0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .card-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--dark-gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .card-icon.primary {
        background: linear-gradient(135deg, rgba(74, 107, 223, 0.1), rgba(108, 99, 255, 0.1));
        color: var(--primary-color);
    }
    
    .card-icon.success {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(25, 135, 84, 0.1));
        color: #28a745;
    }
    
    .card-icon.warning {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
        color: #ffc107;
    }
    
    .card-icon.danger {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(214, 51, 132, 0.1));
        color: #dc3545;
    }
    
    .card-value {
        font-size: 2.4rem;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    .card-change {
        font-size: 0.9rem;
        color: var(--dark-gray);
        display: flex;
        align-items: center;
    }
    
    .card-change i {
        margin-right: 5px;
    }
    
    .card-change.positive {
        color: #28a745;
    }
    
    .card-change.negative {
        color: #dc3545;
    }
    
    .list-group-item {
        border: none;
        border-bottom: 1px solid #f1f1f1;
        padding: 0.6rem 0.8rem;
    }
    
    .list-group-item:last-child {
        border-bottom: none;
    }
    
    .calendar-container {
        position: relative;
        width: 100%;
    }
    
    .calendar-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .calendar-table th,
    .calendar-table td {
        padding: 8px;
        text-align: center;
        border: 1px solid #eee;
    }
    
    .calendar-table th {
        background-color: var(--primary-color);
        color: white;
    }
    
    .calendar-table .weekend {
        background-color: #fff3cd;
    }
    
    .calendar-table .holiday {
        background-color: #f8d7da;
    }
    
    .calendar-table .today {
        background-color: #d1ecf1;
        font-weight: bold;
    }
    
    .chart-container {
        position: relative;
        width: 100%;
        height: 300px;
    }
</style>
{% endblock extra_css %}

{% block content %}
<div class="page-header">
    <h1>Faculty Dashboard</h1>
    <p>Welcome back! Here's what's happening with your faculty department today.</p>
</div>

<!-- Summary Cards -->
<div class="dashboard-cards">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Total Teachers</div>
            <div class="card-icon primary">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.teachers.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.teachers.active }} Active
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Total Students</div>
            <div class="card-icon success">
                <i class="fas fa-user-graduate"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.students.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.students.active }} Active
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Active Courses</div>
            <div class="card-icon warning">
                <i class="fas fa-book"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.courses.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.courses.active }} Active
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <div class="card-title">Pending Requests</div>
            <div class="card-icon danger">
                <i class="fas fa-tasks"></i>
            </div>
        </div>
        <div class="card-value">{{ summary_data.requests.total }}</div>
        <div class="card-change positive">
            <i class="fas fa-arrow-up"></i> {{ summary_data.requests.active }} Pending
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="fas fa-user-clock me-2"></i> Pending Enrollments</h5>
    </div>
    <div class="card-body">
        {% if enrollments %}
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Student</th>
                        <th>Course</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for enrollment in enrollments %}
                    <tr>
                        <td>{{ enrollment.student.first_name }} {{ enrollment.student.last_name }}</td>
                        <td>{{ enrollment.course.title }}</td>
                        <td>{{ enrollment.enrolled_at|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'employee:enrollment_action' enrollment.id 'accept' %}" class="btn btn-sm btn-success me-1">
                                <i class="fas fa-check"></i> Accept
                            </a>
                            <a href="{% url 'employee:enrollment_action' enrollment.id 'reject' %}" class="btn btn-sm btn-danger">
                                <i class="fas fa-times"></i> Reject
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-4">
            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No pending enrollments</h5>
            <p class="text-muted">All enrollments have been processed.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Quick Actions</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#createCourseModal">
                    <i class="fas fa-plus me-2"></i> Create Course
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#assignTeacherModal">
                    <i class="fas fa-user-plus me-2"></i> Assign Teacher
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-info w-100" data-bs-toggle="modal" data-bs-target="#studentListModal">
                    <i class="fas fa-user-graduate me-2"></i> Manage Students
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#pendingRequestsModal">
                    <i class="fas fa-tasks me-2"></i> Review Requests
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <!-- Course Enrollment -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i> Course Enrollment</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="courseEnrollmentChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Distribution -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i> Course Distribution</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="courseDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activities and Pending Requests Row -->
<div class="row mb-4">
    <!-- Recent Activities -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-history me-2"></i> Recent Activities</h5>
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#allActivitiesModal">View All</button>
            </div>
            <div class="card-body p-2">
                <ul class="list-group list-group-flush">
                    {% for activity in recent_activities %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>{{ activity.first_name }} {{ activity.last_name }} joined as Teacher</span>
                        <span class="badge bg-secondary">{{ activity.date_joined|timesince }} ago</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">No recent activities</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Pending Requests -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i> Pending Requests</h5>
                <button class="btn btn-sm btn-dark" data-bs-toggle="modal" data-bs-target="#pendingRequestsModal">View All</button>
            </div>
            <div class="card-body p-2">
                <ul class="list-group list-group-flush">
                    {% for request in pending_requests %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ request.title }}</strong>
                            <div class="text-muted small">By {{ request.created_by.first_name }} {{ request.created_by.last_name }}</div>
                        </div>
                        <span class="badge bg-primary">{{ request.created_at|date:"M d" }}</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">No pending requests</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Calendar Row -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">Calendar</h3>
                <div class="d-flex">
                    <button class="btn btn-sm btn-outline-primary me-2" id="prevMonth">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h4 class="mb-0" id="currentMonth">{{ calendar_data.month_name }} {{ calendar_data.year }}</h4>
                    <button class="btn btn-sm btn-outline-primary ms-2" id="nextMonth">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="calendar-container">
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                <th>Sat</th>
                                <th>Sun</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody">
                            {% for week in calendar_data.calendar %}
                            <tr>
                                {% for day in week %}
                                <td class="{% if day == 0 %}empty{% else %}{% if day in calendar_data.weekends %}weekend{% endif %}{% if day == now.day %}today{% endif %}{% endif %}">
                                    {% if day != 0 %}{{ day }}{% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <div class="d-flex align-items-center me-3">
                        <div class="bg-warning p-1 me-2" style="width: 20px; height: 20px;"></div>
                        <span>Weekend (Friday)</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="bg-danger p-1 me-2" style="width: 20px; height: 20px;"></div>
                        <span>Government Holiday</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Data Section -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Export Data</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <a href="{% url 'employee:export_employee_data' %}" class="btn btn-outline-primary w-100">
                    <i class="fas fa-download me-2"></i> Employee Data
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <a href="{% url 'employee:export_course_data' %}" class="btn btn-outline-success w-100">
                    <i class="fas fa-download me-2"></i> Course Data
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-outline-warning w-100" data-bs-toggle="modal" data-bs-target="#studentListModal">
                    <i class="fas fa-user-graduate me-2"></i> Student Data
                </button>
            </div>
            <div class="col-md-3 mb-3">
                <button class="btn btn-outline-info w-100" data-bs-toggle="modal" data-bs-target="#teacherListModal">
                    <i class="fas fa-chalkboard-teacher me-2"></i> Teacher Data
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Create Course Modal -->
<div class="modal fade" id="createCourseModal" tabindex="-1" aria-labelledby="createCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createCourseModalLabel">Create New Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createCourseForm" method="post" action="{% url 'employee:course_create' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="courseTitle" class="form-label">Course Title</label>
                            <input type="text" class="form-control" id="courseTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseType" class="form-label">Course Type</label>
                            <select class="form-select" id="courseType" name="course_type" required>
                                <option value="">Select a type</option>
                                <option value="online">Online</option>
                                <option value="regular">Regular</option>
                                <option value="diploma">Diploma</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="coursePrice" class="form-label">Price</label>
                            <input type="number" class="form-control" id="coursePrice" name="price" min="0" step="0.01" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseDuration" class="form-label">Duration</label>
                            <input type="text" class="form-control" id="courseDuration" name="duration" placeholder="e.g., 8 weeks, 3 months" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseStatus" class="form-label">Status</label>
                            <select class="form-select" id="courseStatus" name="status" required>
                                <option value="draft">Draft</option>
                                <option value="pending_approval">Pending Approval</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="courseSyllabus" class="form-label">Syllabus</label>
                            <input type="file" class="form-control" id="courseSyllabus" name="syllabus">
                        </div>
                        <div class="col-12 mb-3">
                            <label for="courseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="courseDescription" name="description" rows="4" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Course</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Assign Teacher Modal -->
<div class="modal fade" id="assignTeacherModal" tabindex="-1" aria-labelledby="assignTeacherModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="assignTeacherModalLabel">Assign Teacher to Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="assignTeacherForm" method="post" action="{% url 'employee:courseteacher_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherCourse" class="form-label">Course</label>
                            <select class="form-select" id="teacherCourse" name="course" required>
                                <option value="">Select a course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherName" class="form-label">Teacher</label>
                            <select class="form-select" id="teacherName" name="teacher" required>
                                <option value="">Select a teacher</option>
                                {% for teacher in teachers %}
                                <option value="{{ teacher.id }}">{{ teacher.first_name }} {{ teacher.last_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isPrimary" name="is_primary">
                                <label class="form-check-label" for="isPrimary">
                                    Primary Teacher
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Assign Teacher</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Student List Modal -->
<div class="modal fade" id="studentListModal" tabindex="-1" aria-labelledby="studentListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="studentListModalLabel">Manage Students</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Students</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createStudentModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Add New
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" placeholder="Search students..." id="studentSearch">
                            </div>
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="studentStatusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            {% for student in students %}
                            <tr>
                                <td>{{ student.id }}</td>
                                <td>{{ student.username }}</td>
                                <td>{{ student.email }}</td>
                                <td>{{ student.first_name }}</td>
                                <td>{{ student.last_name }}</td>
                                <td>
                                    {% if student.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateStudentModal{{ student.id }}">
                                        Update
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="confirmStudentDelete({{ student.id }})">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Student Modal -->
<div class="modal fade" id="createStudentModal" tabindex="-1" aria-labelledby="createStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createStudentModalLabel">Create New Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createStudentForm" method="post" action="{% url 'employee:user_create' %}">
                {% csrf_token %}
                <input type="hidden" name="role" value="student">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="studentUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="studentUsername" name="username" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="studentEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="studentPassword" name="password1" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentConfirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="studentConfirmPassword" name="password2" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentFirstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="studentFirstName" name="first_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentLastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="studentLastName" name="last_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentDOB" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="studentDOB" name="date_of_birth">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentPhone" class="form-label">Phone</label>
                            <input type="text" class="form-control" id="studentPhone" name="phone">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentGender" class="form-label">Gender</label>
                            <input type="text" class="form-control" id="studentGender" name="gender">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="studentLocation" name="location">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="studentCountry" class="form-label">Country</label>
                            <input type="text" class="form-control" id="studentCountry" name="country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Student</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Student Update Modals -->
{% for student in students %}
<div class="modal fade" id="updateStudentModal{{ student.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:user_update' student.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Student: {{ student.username }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" name="username" value="{{ student.username }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" value="{{ student.email }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" name="first_name" value="{{ student.first_name }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" name="last_name" value="{{ student.last_name }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" name="date_of_birth" value="{{ student.date_of_birth|date:'Y-m-d' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control" name="phone" value="{{ student.phone }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Gender</label>
                            <input type="text" class="form-control" name="gender" value="{{ student.gender }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" value="{{ student.location }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" name="country" value="{{ student.country }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" name="password1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" name="password2">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_active" id="studentActive{{ student.id }}" {% if student.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="studentActive{{ student.id }}">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Student</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Teacher List Modal -->
<div class="modal fade" id="teacherListModal" tabindex="-1" aria-labelledby="teacherListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="teacherListModalLabel">Manage Teachers</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Filter Teachers</h5>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createTeacherModal" data-bs-dismiss="modal">
                            <i class="fas fa-plus me-1"></i> Add New
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" placeholder="Search teachers..." id="teacherSearch">
                            </div>
                            <div class="col-md-6 mb-3">
                                <select class="form-select" id="teacherStatusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teacherTableBody">
                            {% for teacher in teachers %}
                            <tr>
                                <td>{{ teacher.id }}</td>
                                <td>{{ teacher.username }}</td>
                                <td>{{ teacher.email }}</td>
                                <td>{{ teacher.first_name }}</td>
                                <td>{{ teacher.last_name }}</td>
                                <td>
                                    {% if teacher.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#updateTeacherModal{{ teacher.id }}">
                                        Update
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="confirmTeacherDelete({{ teacher.id }})">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Teacher Modal -->
<div class="modal fade" id="createTeacherModal" tabindex="-1" aria-labelledby="createTeacherModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTeacherModalLabel">Create New Teacher</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createTeacherForm" method="post" action="{% url 'employee:user_create' %}">
                {% csrf_token %}
                <input type="hidden" name="role" value="employee">
                <input type="hidden" name="sub_role" value="teacher">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newTeacherUsername" name="username" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="newTeacherEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newTeacherPassword" name="password1" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherConfirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="newTeacherConfirmPassword" name="password2" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherFirstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="newTeacherFirstName" name="first_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherLastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="newTeacherLastName" name="last_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherDOB" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="newTeacherDOB" name="date_of_birth">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherPhone" class="form-label">Phone</label>
                            <input type="text" class="form-control" id="newTeacherPhone" name="phone">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherGender" class="form-label">Gender</label>
                            <input type="text" class="form-control" id="newTeacherGender" name="gender">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="newTeacherLocation" name="location">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="newTeacherCountry" class="form-label">Country</label>
                            <input type="text" class="form-control" id="newTeacherCountry" name="country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Teacher</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Teacher Update Modals -->
{% for teacher in teachers %}
<div class="modal fade" id="updateTeacherModal{{ teacher.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:user_update' teacher.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Update Teacher: {{ teacher.username }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" name="username" value="{{ teacher.username }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" value="{{ teacher.email }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" name="first_name" value="{{ teacher.first_name }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" name="last_name" value="{{ teacher.last_name }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" name="date_of_birth" value="{{ teacher.date_of_birth|date:'Y-m-d' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control" name="phone" value="{{ teacher.phone }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Gender</label>
                            <input type="text" class="form-control" name="gender" value="{{ teacher.gender }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" value="{{ teacher.location }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" name="country" value="{{ teacher.country }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" name="password1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" name="password2">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_active" id="teacherActive{{ teacher.id }}" {% if teacher.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="teacherActive{{ teacher.id }}">
                                    Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Update Teacher</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Pending Requests Modal -->
<div class="modal fade" id="pendingRequestsModal" tabindex="-1" aria-labelledby="pendingRequestsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="pendingRequestsModalLabel">Review Pending Requests</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Course Title</th>
                                <th>Created By</th>
                                <th>Created Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pendingRequestsTableBody">
                            {% for request in pending_requests %}
                            <tr>
                                <td>{{ request.title }}</td>
                                <td>{{ request.created_by.first_name }} {{ request.created_by.last_name }}</td>
                                <td>{{ request.created_at|date:"Y-m-d" }}</td>
                                <td>
                                    <span class="badge bg-warning">{{ request.status|title }}</span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#approveCourseModal{{ request.id }}">
                                        Approve
                                    </button>
                                    <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#rejectCourseModal{{ request.id }}">
                                        Reject
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Approve Course Modals -->
{% for request in pending_requests %}
<div class="modal fade" id="approveCourseModal{{ request.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:course_update' request.id %}">
                {% csrf_token %}
                <input type="hidden" name="status" value="active">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Approve Course: {{ request.title }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to approve this course?</p>
                    <div class="alert alert-info">
                        <strong>Course:</strong> {{ request.title }}<br>
                        <strong>Created by:</strong> {{ request.created_by.first_name }} {{ request.created_by.last_name }}<br>
                        <strong>Created on:</strong> {{ request.created_at|date:"Y-m-d" }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Approve Course</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Reject Course Modals -->
{% for request in pending_requests %}
<div class="modal fade" id="rejectCourseModal{{ request.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'employee:course_update' request.id %}">
                {% csrf_token %}
                <input type="hidden" name="status" value="rejected">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Reject Course: {{ request.title }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to reject this course?</p>
                    <div class="alert alert-info">
                        <strong>Course:</strong> {{ request.title }}<br>
                        <strong>Created by:</strong> {{ request.created_by.first_name }} {{ request.created_by.last_name }}<br>
                        <strong>Created on:</strong> {{ request.created_at|date:"Y-m-d" }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Reject Course</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- All Activities Modal -->
<div class="modal fade" id="allActivitiesModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">All Recent Activities</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Joined Date</th>
                                <th>Days Ago</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in recent_activities %}
                            <tr>
                                <td>{{ activity.first_name }} {{ activity.last_name }}</td>
                                <td>{{ activity.sub_role|title }}</td>
                                <td>{{ activity.date_joined|date:"Y-m-d" }}</td>
                                <td>{{ activity.date_joined|timesince }} ago</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No activities found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Course Enrollment Chart
        const courseEnrollmentCtx = document.getElementById('courseEnrollmentChart').getContext('2d');
        
        fetch(`{% url 'employee:faculty_chart_data' %}?type=course_enrollment`)
            .then(response => response.json())
            .then(data => {
                new Chart(courseEnrollmentCtx, {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
        
        // Course Distribution Chart
        const courseDistributionCtx = document.getElementById('courseDistributionChart').getContext('2d');
        
        fetch(`{% url 'employee:faculty_chart_data' %}?type=course_distribution`)
            .then(response => response.json())
            .then(data => {
                new Chart(courseDistributionCtx, {
                    type: 'pie',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            });
        
        // Calendar navigation
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const currentMonthElement = document.getElementById('currentMonth');
        const calendarBody = document.getElementById('calendarBody');
        
        let currentMonth = {{ calendar_data.month_name|default:'new Date().getMonth()' }};
        let currentYear = {{ calendar_data.year|default:'new Date().getFullYear()' }};
        
        // This is a simplified version - in a real app, you would fetch calendar data for each month
        prevMonthBtn.addEventListener('click', function() {
            // Implementation would go here
            alert('Previous month functionality would be implemented here');
        });
        
        nextMonthBtn.addEventListener('click', function() {
            // Implementation would go here
            alert('Next month functionality would be implemented here');
        });
        
        // Student delete confirmation
        window.confirmStudentDelete = function(studentId) {
            if (confirm('Are you sure you want to delete this student?')) {
                window.location.href = `{% url 'employee:user_delete' 0 %}`.replace('0', studentId);
            }
        };
        
        // Teacher delete confirmation
        window.confirmTeacherDelete = function(teacherId) {
            if (confirm('Are you sure you want to delete this teacher?')) {
                window.location.href = `{% url 'employee:user_delete' 0 %}`.replace('0', teacherId);
            }
        };
    });
</script>
{% endblock extra_js %}